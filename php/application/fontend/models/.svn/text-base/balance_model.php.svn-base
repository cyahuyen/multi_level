<?php

class Balance_model extends CI_Model {

    private $tbl = 'user_balance';
    private $id = 'user_id';

    function __construct() {
        parent::__construct();
    }

    function getBalaceById($id, $code) {

        $sql = $this->db->get_where($this->tbl, array('user_id' => $id, 'currency_code' => $code))->result();
        if ($sql)
            return $sql[0]->balance;
        else {
            return 0;
        }
    }

    function getBalaceByUser($id) {
        $sql = "SELECT * FROM " . $this->tbl . " WHERE user_id= '" . (int) $id . "'";

        $data = $this->db->query($sql)->result();

        return $data;
    }

    function save($data) {
        $this->db->insert($this->tbl, $data);

        return $this->db->insert_id();
    }

    function update($id, $code, $data) {
        $this->db->where($this->id, $id);

        $this->db->where('currency_code', $code);

        return $this->db->update($this->tbl, $data);
    }

    function updatePublish($id, $data) {
        foreach ($data['balance'] as $publishs => $value) {
            $this->db->query("UPDATE " . $this->tbl . " SET published = '" . (int) $value['published'] . "' WHERE user_id='" . (int) $id . "' AND currency_code='" . $publishs . "'");
        }
        return $this->db->insert_id();
    }

}